{"version":3,"sources":["webpack:///./src/components/ASIICubeInteractive/utils.js","webpack:///./src/components/ASIICubeInteractive/index.js","webpack:///./src/pages/medium.js","webpack:///./src/components/back.js"],"names":["x","context","cos","Math","PI","sin","pixelSize","fov","tan","ascii","fun","y","z","max","abs","sqrt1b","column","c","row","col","x0","cols","ux","scaleX","rows","vx","scaleY","y0","vy","z0","uz","vz","n","sqrt1a","I","nx","ny","nz","dist","i","camX","camY","camZ","compute","R0","iterations","r","min","round","length","line","res","minCol","maxCol","push","processor","state","distance","alpha","beta","minRow","maxRow","toFixed","join","init","setState","events","mousewheel","deltaY","delta","distancePrev","computeDistance","mousemove","clientX","clientY","isProgress","eventClientX","eventClientY","alphaPrev","betaPrev","floor","computePosition","mousedown","mouseup","blur","Object","keys","map","event","document","addEventListener","window","removeEventListener","size","fontSize","initState","undefined","ASIICubeInteractive","useState","refCanvas","useRef","useEffect","canvas","current","getContext","width","height","font","fillStyle","clearRect","no","fillText","ref","className","styles","Canvas","MediumPage","Back","to"],"mappings":"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","file":"component---src-pages-medium-js-beab2c0fdcbad781322d.js","sourcesContent":["const fov = 35\r\nconst cos = x => Math.cos((x * Math.PI) / 180)\r\nconst sin = x => Math.sin((x * Math.PI) / 180)\r\nconst tan = x => Math.tan((x * Math.PI) / 180)\r\nconst rows = 36\r\nconst camPrecision = 2\r\nconst pixelSize = tan(fov / 2) / ((rows - 1) / 2)\r\nconst colorShift = 0\r\nconst gamma = 1\r\nconst ascii = `$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/|()1{}[]?-_+~<>i!lI;:,\"^. `\r\nconst iterations = 15\r\nconst vector = ({ distance, alpha, beta }) => ({\r\n  minRow: 3,\r\n  maxRow: 40,\r\n  minCol: 0,\r\n  maxCol: 80 + 9,\r\n  rows: 36 + 7,\r\n  cols: 80 + 10,\r\n  scaleX: 0.6,\r\n  scaleY: 1.5,\r\n  camX: +(distance * cos(alpha) * cos(beta)).toFixed(camPrecision),\r\n  camY: +(distance * sin(beta)).toFixed(camPrecision),\r\n  camZ: +(distance * sin(alpha) * cos(beta)).toFixed(camPrecision),\r\n  ux: -pixelSize * sin(alpha),\r\n  uz: +pixelSize * cos(alpha),\r\n  vx: +pixelSize * cos(alpha) * sin(beta),\r\n  vy: -pixelSize * cos(beta),\r\n  vz: +pixelSize * sin(alpha) * sin(beta),\r\n  x0: -cos(alpha) * cos(beta),\r\n  y0: -sin(beta),\r\n  z0: -sin(alpha) * cos(beta),\r\n})\r\nconst sqrt1a = x => (1 + x) / 2\r\nconst sqrt1b = x => 0.14 + 1.78 * x\r\nconst fun = (x, y, z) =>\r\n  Math.max(\r\n    Math.abs(x) - 0.3,\r\n    Math.abs(y) - 0.3,\r\n    Math.abs(z) - 0.3,\r\n    -sqrt1b(x * x + y * y + z * z) + 0.42\r\n  )\r\nconst compute = (c, [nx, ny, nz]) => {\r\n  const I = []\r\n  let dist = 0\r\n\r\n  for (let i = 0; i <= iterations; i++) {\r\n    dist += fun(c.camX + nx * dist, c.camY + ny * dist, c.camZ + nz * dist)\r\n    I[i] = dist\r\n  }\r\n\r\n  return I\r\n}\r\nconst column = (c, row, col) => {\r\n  const x =\r\n    c.x0 +\r\n    (col - c.cols / 2) * c.ux * c.scaleX +\r\n    (row - c.rows / 2) * c.vx * c.scaleY\r\n  const y = c.y0 + (row - c.rows / 2) * c.vy * c.scaleY\r\n  const z =\r\n    c.z0 +\r\n    (col - c.cols / 2) * c.uz * c.scaleX +\r\n    (row - c.rows / 2) * c.vz * c.scaleY\r\n  const n = sqrt1a(x * x + y * y + z * z)\r\n  const I = compute(c, [x / n, y / n, z / n])\r\n  const R0 =\r\n    (I[iterations] - I[iterations - 1]) /\r\n    (I[iterations - 1] - I[iterations - 2])\r\n  const r = Math.min(1, Math.max(0, R0 + colorShift)) ** gamma\r\n\r\n  return `${ascii[Math.round(r * (ascii.length - 1))]}`[0]\r\n}\r\nconst line = (c, row) => {\r\n  const res = []\r\n\r\n  for (let col = c.minCol; col < c.maxCol; col++) {\r\n    res.push(column(c, row, col))\r\n  }\r\n\r\n  return res\r\n}\r\nconst computeDistance = ({ distance: distancePrev, ...state }, delta) => ({\r\n  ...state,\r\n  distance: Math.max(\r\n    Math.min(distancePrev + (delta > 0 ? 0.1 : -0.1), 2.5),\r\n    0.5\r\n  ),\r\n})\r\nconst computePosition = (\r\n  { alphaPrev, betaPrev, clientX, clientY, ...state },\r\n  eventClientX,\r\n  eventClientY\r\n) => ({\r\n  ...state,\r\n  alphaPrev,\r\n  betaPrev,\r\n  clientX,\r\n  clientY,\r\n  alpha: alphaPrev + Math.floor((clientX - eventClientX) / 5),\r\n  beta: betaPrev - Math.floor((clientY - eventClientY) / 5),\r\n})\r\n\r\nexport const processor = state => {\r\n  const c = vector(state)\r\n  const res = []\r\n\r\n  for (let row = c.minRow; row < c.maxRow; row++) {\r\n    res.push(line(c, row).join(``))\r\n  }\r\n\r\n  return res\r\n}\r\n\r\nexport const init = setState => {\r\n  const events = {\r\n    mousewheel: ({ deltaY }) => {\r\n      setState(state => computeDistance(state, deltaY))\r\n    },\r\n    mousemove: ({ clientX, clientY }) => {\r\n      setState(state =>\r\n        state.isProgress ? computePosition(state, clientX, clientY) : state\r\n      )\r\n    },\r\n    mousedown: ({ clientX, clientY }) => {\r\n      setState(state => ({\r\n        ...state,\r\n        isProgress: true,\r\n        alphaPrev: state.alpha,\r\n        betaPrev: state.beta,\r\n        clientX,\r\n        clientY,\r\n      }))\r\n    },\r\n    mouseup: () => {\r\n      setState(state => ({\r\n        ...state,\r\n        isProgress: false,\r\n      }))\r\n    },\r\n  }\r\n  const blur = () => {\r\n    setState(state => ({\r\n      ...state,\r\n      isProgress: false,\r\n    }))\r\n  }\r\n\r\n  Object.keys(events).map(event =>\r\n    document.addEventListener(event, events[event])\r\n  )\r\n  window.addEventListener(`blur`, blur)\r\n\r\n  return () => {\r\n    Object.keys(events).map(event =>\r\n      document.removeEventListener(event, events[event])\r\n    )\r\n    window.removeEventListener(`blur`, blur)\r\n  }\r\n}\r\n","import React, { useEffect, useRef, useState } from 'react'\r\n\r\nimport { processor, init } from './utils'\r\nimport styles from 'styles/main.module.css'\r\n\r\nconst size = 600\r\nconst fontSize = Math.round(size / 50)\r\nconst initState = {\r\n  distance: 1.3,\r\n  alpha: 15,\r\n  beta: 30,\r\n  alphaPrev: 15,\r\n  betaPrev: 30,\r\n  clientX: undefined,\r\n  clientY: undefined,\r\n  isProgress: false,\r\n}\r\n\r\nlet context\r\n\r\nfunction ASIICubeInteractive() {\r\n  const [state, setState] = useState(initState)\r\n  const refCanvas = useRef()\r\n\r\n  useEffect(() => {\r\n    const { current: canvas } = refCanvas\r\n\r\n    context = canvas.getContext(`2d`)\r\n\r\n    canvas.width = size\r\n    canvas.height = size\r\n    context.font = `${fontSize}px monospace`\r\n    context.fillStyle = `black`\r\n\r\n    return init(setState)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    context.clearRect(0, 0, context.canvas.width, context.canvas.height)\r\n    processor(state).map((line, no) =>\r\n      context.fillText(line, 5, 5 + no * fontSize * 1.4)\r\n    )\r\n  }, [state])\r\n\r\n  return <canvas ref={refCanvas} className={styles.Canvas} />\r\n}\r\n\r\nexport default ASIICubeInteractive\r\n","import React from 'react'\r\n\r\nimport Back from 'components/back'\r\nimport ASIICubeInteractive from 'components/ASIICubeInteractive'\r\nimport Layout from 'components/layout'\r\n\r\nconst MediumPage = () => (\r\n  <Layout>\r\n    <div>\r\n      <Back />\r\n      <ASIICubeInteractive />\r\n    </div>\r\n  </Layout>\r\n)\r\n\r\nexport default MediumPage\r\n","import React from 'react'\r\nimport Link from 'gatsby-link'\r\n\r\nconst Back = () => (\r\n  <p>\r\n    &larr; <Link to=\"/\">Back</Link>\r\n  </p>\r\n)\r\n\r\nexport default Back\r\n"],"sourceRoot":""}